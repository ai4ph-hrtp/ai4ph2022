<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Text Analytics with R: Classification | AI4PH: Text Analyses with R Tutorial and Data Challenge</title>
  <meta name="description" content="Welcome to AI4PH Summer Institute 2022." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Text Analytics with R: Classification | AI4PH: Text Analyses with R Tutorial and Data Challenge" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Welcome to AI4PH Summer Institute 2022." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Text Analytics with R: Classification | AI4PH: Text Analyses with R Tutorial and Data Challenge" />
  
  <meta name="twitter:description" content="Welcome to AI4PH Summer Institute 2022." />
  

<meta name="author" content="Yuan Tian" />


<meta name="date" content="2022-07-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="prerequisite.html"/>
<link rel="next" href="tutorial2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://bookdown.org/tianyuan09/ai4ph2022/">AI4PH2022</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="prerequisite.html"><a href="prerequisite.html"><i class="fa fa-check"></i><b>1</b> Prerequisite</a>
<ul>
<li class="chapter" data-level="1.1" data-path="prerequisite.html"><a href="prerequisite.html#before-the-sessions"><i class="fa fa-check"></i><b>1.1</b> Before the sessions</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="prerequisite.html"><a href="prerequisite.html#install-required-r-packages"><i class="fa fa-check"></i><b>1.1.1</b> Install Required R Packages</a></li>
<li class="chapter" data-level="1.1.2" data-path="prerequisite.html"><a href="prerequisite.html#twitter-dataset-for-the-tutorial"><i class="fa fa-check"></i><b>1.1.2</b> Twitter Dataset for the Tutorial</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tutorial.html"><a href="tutorial.html"><i class="fa fa-check"></i><b>2</b> Text Analytics with R: Classification</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tutorial.html"><a href="tutorial.html#initial-r-setup"><i class="fa fa-check"></i><b>2.1</b> Initial R Setup</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="tutorial.html"><a href="tutorial.html#load-the-r-packages"><i class="fa fa-check"></i><b>2.1.1</b> Load the R Packages</a></li>
<li class="chapter" data-level="2.1.2" data-path="tutorial.html"><a href="tutorial.html#load-the-twitter-data-for-classification"><i class="fa fa-check"></i><b>2.1.2</b> Load the Twitter Data for Classification</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="tutorial.html"><a href="tutorial.html#data-pre-processing"><i class="fa fa-check"></i><b>2.2</b> Data Pre-processing</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="tutorial.html"><a href="tutorial.html#regular-expressions"><i class="fa fa-check"></i><b>2.2.1</b> Regular Expressions</a></li>
<li class="chapter" data-level="2.2.2" data-path="tutorial.html"><a href="tutorial.html#tokenization"><i class="fa fa-check"></i><b>2.2.2</b> Tokenization</a></li>
<li class="chapter" data-level="2.2.3" data-path="tutorial.html"><a href="tutorial.html#stop-words"><i class="fa fa-check"></i><b>2.2.3</b> Stop Words</a></li>
<li class="chapter" data-level="2.2.4" data-path="tutorial.html"><a href="tutorial.html#stemming"><i class="fa fa-check"></i><b>2.2.4</b> Stemming</a></li>
<li class="chapter" data-level="2.2.5" data-path="tutorial.html"><a href="tutorial.html#exporatory-data-analysis"><i class="fa fa-check"></i><b>2.2.5</b> Exporatory Data Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="tutorial.html"><a href="tutorial.html#classification-models"><i class="fa fa-check"></i><b>2.3</b> Classification Models</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="tutorial.html"><a href="tutorial.html#split-the-training-and-test-set"><i class="fa fa-check"></i><b>2.3.1</b> Split the Training and Test Set</a></li>
<li class="chapter" data-level="2.3.2" data-path="tutorial.html"><a href="tutorial.html#pre-processing-with-the-recipe"><i class="fa fa-check"></i><b>2.3.2</b> Pre-processing with the <code>recipe()</code></a></li>
<li class="chapter" data-level="2.3.3" data-path="tutorial.html"><a href="tutorial.html#choose-a-classification-model"><i class="fa fa-check"></i><b>2.3.3</b> Choose a Classification Model</a></li>
<li class="chapter" data-level="2.3.4" data-path="tutorial.html"><a href="tutorial.html#the-workflow-for-bundling-recipe-and-models"><i class="fa fa-check"></i><b>2.3.4</b> The <code>workflow()</code> for bundling <code>recipe()</code> and models</a></li>
<li class="chapter" data-level="2.3.5" data-path="tutorial.html"><a href="tutorial.html#model-evaluation"><i class="fa fa-check"></i><b>2.3.5</b> Model Evaluation</a></li>
<li class="chapter" data-level="2.3.6" data-path="tutorial.html"><a href="tutorial.html#evaluate-on-the-testing-set-optional"><i class="fa fa-check"></i><b>2.3.6</b> Evaluate on the Testing Set (Optional)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tutorial2.html"><a href="tutorial2.html"><i class="fa fa-check"></i><b>3</b> Text Analytics with R: Topic Modelling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tutorial2.html"><a href="tutorial2.html#initial-r-setup-1"><i class="fa fa-check"></i><b>3.1</b> Initial R Setup</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="tutorial2.html"><a href="tutorial2.html#load-the-r-packages-1"><i class="fa fa-check"></i><b>3.1.1</b> Load the R Packages</a></li>
<li class="chapter" data-level="3.1.2" data-path="tutorial2.html"><a href="tutorial2.html#load-the-twitter-data-for-topic-modelling"><i class="fa fa-check"></i><b>3.1.2</b> Load the Twitter Data for Topic Modelling</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tutorial2.html"><a href="tutorial2.html#topic-modelling"><i class="fa fa-check"></i><b>3.2</b> Topic Modelling</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="tutorial2.html"><a href="tutorial2.html#latent-dirichlet-allocation-lda"><i class="fa fa-check"></i><b>3.2.1</b> Latent Dirichlet allocation (LDA)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html"><i class="fa fa-check"></i><b>4</b> Data Challenge Prep</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html#n2c2-nlp-research-datasets"><i class="fa fa-check"></i><b>4.1</b> N2C2 NLP Research Datasets</a></li>
<li class="chapter" data-level="4.2" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html#initial-r-setup-2"><i class="fa fa-check"></i><b>4.2</b> Initial R Setup</a></li>
<li class="chapter" data-level="4.3" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html#reading-xml-files-in-r"><i class="fa fa-check"></i><b>4.3</b> Reading XML files in R</a></li>
<li class="chapter" data-level="4.4" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html#preprocessing-the-text-column-in-the-pt_record_raw-dataframe"><i class="fa fa-check"></i><b>4.4</b> Preprocessing the <code>text</code> column in the <code>pt_record_raw</code> dataframe</a></li>
<li class="chapter" data-level="4.5" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html#descriptive-statistics"><i class="fa fa-check"></i><b>4.5</b> Descriptive Statistics</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html#discharge-summary-dataset"><i class="fa fa-check"></i><b>4.5.1</b> Discharge Summary Dataset</a></li>
<li class="chapter" data-level="4.5.2" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html#the-annotation-dataset"><i class="fa fa-check"></i><b>4.5.2</b> The Annotation Dataset</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html#your-analyses"><i class="fa fa-check"></i><b>4.6</b> Your Analyses</a></li>
<li class="chapter" data-level="4.7" data-path="data-challenge-prep.html"><a href="data-challenge-prep.html#appendixfeature"><i class="fa fa-check"></i><b>4.7</b> Appendix: Feature Manual Extraction from the Text</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="relevant-resources.html"><a href="relevant-resources.html"><i class="fa fa-check"></i><b>5</b> Relevant Resources</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">AI4PH: Text Analyses with R Tutorial and Data Challenge</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tutorial" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Text Analytics with R: Classification<a href="tutorial.html#tutorial" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This tutorial introduces text analyses in R using a variety of R packages and tidy tools.</p>
<div id="initial-r-setup" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Initial R Setup<a href="tutorial.html#initial-r-setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="load-the-r-packages" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Load the R Packages<a href="tutorial.html#load-the-r-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Load and import the necessary R packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="tutorial.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="tutorial.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># a collection of package for data wrangling.</span></span>
<span id="cb1-3"><a href="tutorial.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="tutorial.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># package for text processing</span></span>
<span id="cb1-5"><a href="tutorial.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-6"><a href="tutorial.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># collection of packages for modeling and L </span></span>
<span id="cb1-7"><a href="tutorial.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-8"><a href="tutorial.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-9"><a href="tutorial.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># R package for managing and analyzing textual data</span></span>
<span id="cb1-10"><a href="tutorial.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb1-11"><a href="tutorial.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># An R package with word stemming algorithm</span></span>
<span id="cb1-12"><a href="tutorial.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># collapsing words to a common root to aid comparison of vocabular. </span></span>
<span id="cb1-13"><a href="tutorial.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SnowballC)</span>
<span id="cb1-14"><a href="tutorial.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># library for topic models (LDA)</span></span>
<span id="cb1-15"><a href="tutorial.html#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(topicmodels)</span>
<span id="cb1-16"><a href="tutorial.html#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># text recipe</span></span>
<span id="cb1-17"><a href="tutorial.html#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textrecipes)</span>
<span id="cb1-18"><a href="tutorial.html#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># dealing with imbalance data using `step_downsample or upsample`.</span></span>
<span id="cb1-19"><a href="tutorial.html#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(themis)</span>
<span id="cb1-20"><a href="tutorial.html#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/tidymodels/discrim</span></span>
<span id="cb1-21"><a href="tutorial.html#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(discrim)</span>
<span id="cb1-22"><a href="tutorial.html#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># framework for constructing variable importance plots from ML models</span></span>
<span id="cb1-23"><a href="tutorial.html#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span></code></pre></div>
</div>
<div id="load-the-twitter-data-for-classification" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Load the Twitter Data for Classification<a href="tutorial.html#load-the-twitter-data-for-classification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will use the Twitter data for classification in this section.</p>
<p>The world is a mix of multiple language. Different languages might be encoded differently. For instance, English is very well encoded using ASCII. ASCII stands for American Standard Code for Information Interchange. But this is not the only standard. Other languages have different encoding standards.</p>
<p><a href="https://en.wikipedia.org/wiki/UTF-8">UTF-8</a>, the Unicode Standard, is a variable-width character encoding being used almost exclusively now.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="tutorial.html#cb2-1" aria-hidden="true" tabindex="-1"></a>urlfile_class <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/tianyuan09/ai4ph2022/main/sampleTwitterDataForClassification.csv&quot;</span></span>
<span id="cb2-2"><a href="tutorial.html#cb2-2" aria-hidden="true" tabindex="-1"></a>tweetsDF <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(urlfile_class), <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb2-3"><a href="tutorial.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tweetsDF)</span>
<span id="cb2-4"><a href="tutorial.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;X.1&quot;        &quot;X&quot;          &quot;tweet&quot;      &quot;annotation&quot;</span></span>
<span id="cb2-5"><a href="tutorial.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(tweetsDF) <span class="co"># check the # of rows</span></span>
<span id="cb2-6"><a href="tutorial.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 5969</span></span>
<span id="cb2-7"><a href="tutorial.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tweetsDF<span class="sc">$</span>annotation) <span class="co"># build a contingency table of counts</span></span>
<span id="cb2-8"><a href="tutorial.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb2-9"><a href="tutorial.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="do">##    0    1 </span></span>
<span id="cb2-10"><a href="tutorial.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 5530  439</span></span>
<span id="cb2-11"><a href="tutorial.html#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># print the a few tweets</span></span>
<span id="cb2-12"><a href="tutorial.html#cb2-12" aria-hidden="true" tabindex="-1"></a>tweetsDF<span class="sc">$</span>tweet[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb2-13"><a href="tutorial.html#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;@sharscott12 Tramidol is mostly for headaches/migraines. So yeah it isn’t overly strong. Oh I was like you. I tried absolutely everything before opioids. So I’m definitely with you to go a route before that.&quot;</span></span>
<span id="cb2-14"><a href="tutorial.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] &quot;RT @PSilvervoodoos: Playlist Ordinary Man - Ozzy Osbourne by @_CaviarMusic_  @GreenDay @RufuskingBand @ShadowofEverest @gozer_goodspeed @Le…&quot;                                                                   </span></span>
<span id="cb2-15"><a href="tutorial.html#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] &quot;@JoMichigan1 @TheDailyShow If he&#39;s alone in his own house then he&#39;s free to cough and touch his face ; so not seeing the issue?&quot;</span></span></code></pre></div>
</div>
</div>
<div id="data-pre-processing" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Data Pre-processing<a href="tutorial.html#data-pre-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, you will:</p>
<ul>
<li>know how to manipulate text using simple regular expressions</li>
<li>know how to tokenize text</li>
<li>know how to remove stop words</li>
<li>know how to do stemming</li>
</ul>
<div id="regular-expressions" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Regular Expressions<a href="tutorial.html#regular-expressions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When you’re processing free-text, we come across a lot of places where regular expressions or patterns play a role. Here are a few examples of using regular expressions with the <code>str_detect()</code>, <code>str_extract()</code> and <code>str_replace()</code> functions.</p>
<p>A typical tweet might have callouts (e.g., <code>@SciFiTV50</code>), hashtags (e.g., <code>#92</code>) and URLs (e.g. <code>https://t.co/7Mo59nwE39</code>). There is a clear pattern for these information in the tweet. We can either remove them or replace them with user-defined patterns.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="tutorial.html#cb3-1" aria-hidden="true" tabindex="-1"></a>tweet <span class="ot">&lt;-</span> <span class="st">&quot;RT @PurpleForever19 @SciFiTV50 @ufpearth Cool! # #AI4PH #92. #whatif commentary 200 https://t.co/7Mde3&quot;</span></span>
<span id="cb3-2"><a href="tutorial.html#cb3-2" aria-hidden="true" tabindex="-1"></a>tweet</span>
<span id="cb3-3"><a href="tutorial.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT @PurpleForever19 @SciFiTV50 @ufpearth Cool! # #AI4PH #92. #whatif commentary 200 https://t.co/7Mde3&quot;</span></span>
<span id="cb3-4"><a href="tutorial.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check if the text contains a pattern</span></span>
<span id="cb3-5"><a href="tutorial.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(tweet,<span class="st">&quot;@&quot;</span>)</span>
<span id="cb3-6"><a href="tutorial.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb3-7"><a href="tutorial.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the first match with the pattern</span></span>
<span id="cb3-8"><a href="tutorial.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># *: zero to many, []: list characters</span></span>
<span id="cb3-9"><a href="tutorial.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(tweet,<span class="st">&quot;#[a-zA-Z0-9]*&quot;</span>)</span>
<span id="cb3-10"><a href="tutorial.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;#&quot;</span></span>
<span id="cb3-11"><a href="tutorial.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># extract all the matches to the pattern</span></span>
<span id="cb3-12"><a href="tutorial.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract_all</span>(tweet,<span class="st">&quot;#[a-zA-Z0-9]*&quot;</span>)</span>
<span id="cb3-13"><a href="tutorial.html#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [[1]]</span></span>
<span id="cb3-14"><a href="tutorial.html#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;#&quot;       &quot;#AI4PH&quot;  &quot;#92&quot;     &quot;#whatif&quot;</span></span>
<span id="cb3-15"><a href="tutorial.html#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># replace usernames (starts with @) with empty &quot;&quot;. </span></span>
<span id="cb3-16"><a href="tutorial.html#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(tweet, <span class="st">&quot;@[a-z,A-Z]*[0-9]*[a-z,A-Z]*&quot;</span>, <span class="st">&quot;USERNAME&quot;</span>)</span>
<span id="cb3-17"><a href="tutorial.html#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT USERNAME USERNAME USERNAME Cool! # #AI4PH #92. #whatif commentary 200 https://t.co/7Mde3&quot;</span></span></code></pre></div>
<p>Suppose that we are not interested in them. We can remove them from tweet text using <a href="https://cran.r-project.org/web/packages/stringr/vignettes/regular-expressions.html">regular expressions</a>.</p>
<p>Several user-defined functions (UDF) were created to remove this information from the text. In essence, we want to find the patterns that match <code>@</code>, <code>#</code> and <code>https://</code> in the text, and replace them with <code>''</code> (blank).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="tutorial.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">### UDF to remove the URLs from the tweets</span></span>
<span id="cb4-2"><a href="tutorial.html#cb4-2" aria-hidden="true" tabindex="-1"></a>removeURLs <span class="ot">&lt;-</span> <span class="cf">function</span>(tweet) {</span>
<span id="cb4-3"><a href="tutorial.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">gsub</span>(<span class="st">&quot;http</span><span class="sc">\\</span><span class="st">S+&quot;</span>, <span class="st">&quot;&quot;</span>, tweet))</span>
<span id="cb4-4"><a href="tutorial.html#cb4-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-5"><a href="tutorial.html#cb4-5" aria-hidden="true" tabindex="-1"></a>tweet <span class="co"># before removal</span></span>
<span id="cb4-6"><a href="tutorial.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT @PurpleForever19 @SciFiTV50 @ufpearth Cool! # #AI4PH #92. #whatif commentary 200 https://t.co/7Mde3&quot;</span></span>
<span id="cb4-7"><a href="tutorial.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">removeURLs</span>(tweet) <span class="co"># after removal</span></span>
<span id="cb4-8"><a href="tutorial.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT @PurpleForever19 @SciFiTV50 @ufpearth Cool! # #AI4PH #92. #whatif commentary 200 &quot;</span></span>
<span id="cb4-9"><a href="tutorial.html#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="tutorial.html#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">### UDF to remove RT from the tweets</span></span>
<span id="cb4-11"><a href="tutorial.html#cb4-11" aria-hidden="true" tabindex="-1"></a>removeUsernamesWithRT <span class="ot">&lt;-</span> <span class="cf">function</span>(tweet) {</span>
<span id="cb4-12"><a href="tutorial.html#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">gsub</span>(<span class="st">&quot;^RT @[a-z,A-Z]*[0-9]*[a-z,A-Z]*[0-9]*: &quot;</span>,<span class="st">&quot;&quot;</span>, tweet))</span>
<span id="cb4-13"><a href="tutorial.html#cb4-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-14"><a href="tutorial.html#cb4-14" aria-hidden="true" tabindex="-1"></a>tweet</span>
<span id="cb4-15"><a href="tutorial.html#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT @PurpleForever19 @SciFiTV50 @ufpearth Cool! # #AI4PH #92. #whatif commentary 200 https://t.co/7Mde3&quot;</span></span>
<span id="cb4-16"><a href="tutorial.html#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">removeUsernamesWithRT</span>(tweet) <span class="co"># after removal</span></span>
<span id="cb4-17"><a href="tutorial.html#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT @PurpleForever19 @SciFiTV50 @ufpearth Cool! # #AI4PH #92. #whatif commentary 200 https://t.co/7Mde3&quot;</span></span>
<span id="cb4-18"><a href="tutorial.html#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="tutorial.html#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="do">### UDF to remove the usernames or callouts from the tweets</span></span>
<span id="cb4-20"><a href="tutorial.html#cb4-20" aria-hidden="true" tabindex="-1"></a>removeUsernames <span class="ot">&lt;-</span> <span class="cf">function</span>(tweet) {</span>
<span id="cb4-21"><a href="tutorial.html#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">gsub</span>(<span class="st">&quot;@[a-z,A-Z]*[0-9]*[a-z,A-Z]*[0-9]*&quot;</span>, <span class="st">&quot;&quot;</span>, tweet))</span>
<span id="cb4-22"><a href="tutorial.html#cb4-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-23"><a href="tutorial.html#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="tutorial.html#cb4-24" aria-hidden="true" tabindex="-1"></a>tweet</span>
<span id="cb4-25"><a href="tutorial.html#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT @PurpleForever19 @SciFiTV50 @ufpearth Cool! # #AI4PH #92. #whatif commentary 200 https://t.co/7Mde3&quot;</span></span>
<span id="cb4-26"><a href="tutorial.html#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">removeUsernames</span>(tweet)<span class="co"># after removal</span></span>
<span id="cb4-27"><a href="tutorial.html#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT    Cool! # #AI4PH #92. #whatif commentary 200 https://t.co/7Mde3&quot;</span></span>
<span id="cb4-28"><a href="tutorial.html#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="tutorial.html#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="do">### remove the hashtag # from the tweets</span></span>
<span id="cb4-30"><a href="tutorial.html#cb4-30" aria-hidden="true" tabindex="-1"></a>removeHashtagSignOnly <span class="ot">&lt;-</span> <span class="cf">function</span>(tweet) {</span>
<span id="cb4-31"><a href="tutorial.html#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">gsub</span>(<span class="st">&quot;#&quot;</span>, <span class="st">&quot;&quot;</span>, tweet))</span>
<span id="cb4-32"><a href="tutorial.html#cb4-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-33"><a href="tutorial.html#cb4-33" aria-hidden="true" tabindex="-1"></a>tweet</span>
<span id="cb4-34"><a href="tutorial.html#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT @PurpleForever19 @SciFiTV50 @ufpearth Cool! # #AI4PH #92. #whatif commentary 200 https://t.co/7Mde3&quot;</span></span>
<span id="cb4-35"><a href="tutorial.html#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="fu">removeHashtagSignOnly</span>(tweet)</span>
<span id="cb4-36"><a href="tutorial.html#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;RT @PurpleForever19 @SciFiTV50 @ufpearth Cool!  AI4PH 92. whatif commentary 200 https://t.co/7Mde3&quot;</span></span></code></pre></div>
<p>We clean our raw tweet data by applying the UDFs on the <code>tweet</code> column.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="tutorial.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Remove the URLs and usernames from the tweets</span></span>
<span id="cb5-2"><a href="tutorial.html#cb5-2" aria-hidden="true" tabindex="-1"></a>tweetsDF<span class="sc">$</span>processed_tweet <span class="ot">&lt;-</span> <span class="fu">apply</span>(tweetsDF[<span class="st">&#39;tweet&#39;</span>], <span class="dv">2</span>, removeURLs) </span>
<span id="cb5-3"><a href="tutorial.html#cb5-3" aria-hidden="true" tabindex="-1"></a>tweetsDF<span class="sc">$</span>processed_tweet <span class="ot">&lt;-</span> <span class="fu">apply</span>(tweetsDF[<span class="st">&#39;processed_tweet&#39;</span>],<span class="dv">2</span>, removeUsernamesWithRT) </span>
<span id="cb5-4"><a href="tutorial.html#cb5-4" aria-hidden="true" tabindex="-1"></a>tweetsDF<span class="sc">$</span>processed_tweet <span class="ot">&lt;-</span> <span class="fu">apply</span>(tweetsDF[<span class="st">&#39;processed_tweet&#39;</span>],<span class="dv">2</span>, removeUsernames)</span>
<span id="cb5-5"><a href="tutorial.html#cb5-5" aria-hidden="true" tabindex="-1"></a>tweetsDF<span class="sc">$</span>processed_tweet <span class="ot">&lt;-</span> <span class="fu">apply</span>(tweetsDF[<span class="st">&#39;processed_tweet&#39;</span>],<span class="dv">2</span>, removeHashtagSignOnly)</span></code></pre></div>
</div>
<div id="tokenization" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Tokenization<a href="tutorial.html#tokenization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>What is a token?</strong></p>
<p>A token is a meaningful piece of text, usually a word, that we want to use for further analysis. Tokenization is the process of breaking a piece of text into tokens.</p>
<p>Since each tweet made up of multiple words, we need to convert it into <strong>one-token-per-tweet-per-row</strong> format.</p>
<p>The two basic arguments to <code>unnest_tokens</code>used here are column names. <code>word</code> is the outcome column, <code>tweet</code> is the input column (the text column in the dataset)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="tutorial.html#cb6-1" aria-hidden="true" tabindex="-1"></a>text_df <span class="ot">&lt;-</span> tweetsDF <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="tutorial.html#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(X,annotation,processed_tweet) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="tutorial.html#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_tokens</span>(word, processed_tweet)</span>
<span id="cb6-4"><a href="tutorial.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(text_df)</span>
<span id="cb6-5"><a href="tutorial.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 94599</span></span>
<span id="cb6-6"><a href="tutorial.html#cb6-6" aria-hidden="true" tabindex="-1"></a>tweetsDF<span class="sc">$</span>processed_tweet[<span class="dv">1</span>]</span>
<span id="cb6-7"><a href="tutorial.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot; Tramidol is mostly for headaches/migraines. So yeah it isn’t overly strong. Oh I was like you. I tried absolutely everything before opioids. So I’m definitely with you to go a route before that.&quot;</span></span>
<span id="cb6-8"><a href="tutorial.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(text_df,<span class="dv">10</span>) <span class="co"># take a look at the first 10 rows. </span></span>
<span id="cb6-9"><a href="tutorial.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="do">##    X annotation      word</span></span>
<span id="cb6-10"><a href="tutorial.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  1          0  tramidol</span></span>
<span id="cb6-11"><a href="tutorial.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  1          0        is</span></span>
<span id="cb6-12"><a href="tutorial.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  1          0    mostly</span></span>
<span id="cb6-13"><a href="tutorial.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 4  1          0       for</span></span>
<span id="cb6-14"><a href="tutorial.html#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  1          0 headaches</span></span>
<span id="cb6-15"><a href="tutorial.html#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  1          0 migraines</span></span>
<span id="cb6-16"><a href="tutorial.html#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 7  1          0        so</span></span>
<span id="cb6-17"><a href="tutorial.html#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 8  1          0      yeah</span></span>
<span id="cb6-18"><a href="tutorial.html#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 9  1          0        it</span></span>
<span id="cb6-19"><a href="tutorial.html#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 1          0     isn’t</span></span></code></pre></div>
</div>
<div id="stop-words" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Stop Words<a href="tutorial.html#stop-words" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Stop words are common words that are not useful for text analysis, such as “the,” “of,” “to” and so on in English. We often want to delete stop words in text analysis.</p>
<p>The <code>stop_words</code> dataset in the <code>tidytext</code> package contains stop words from three lexicons. The intersections between different lexicons can be found in <a href="https://smltar.com/stopwords.html#premadestopwords">here</a>. We can use them all together, or use <a href="https://dplyr.tidyverse.org/reference/filter.html"><code>filter()</code></a> to only use one set of stop words.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="tutorial.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at the stop words</span></span>
<span id="cb7-2"><a href="tutorial.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(stop_words)</span>
<span id="cb7-3"><a href="tutorial.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># different lexicons</span></span>
<span id="cb7-4"><a href="tutorial.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(stop_words<span class="sc">$</span>lexicon)</span>
<span id="cb7-5"><a href="tutorial.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;SMART&quot;    &quot;snowball&quot; &quot;onix&quot;</span></span>
<span id="cb7-6"><a href="tutorial.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># count of words for each lexicon</span></span>
<span id="cb7-7"><a href="tutorial.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(stop_words<span class="sc">$</span>lexicon)</span>
<span id="cb7-8"><a href="tutorial.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb7-9"><a href="tutorial.html#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">##     onix    SMART snowball </span></span>
<span id="cb7-10"><a href="tutorial.html#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="do">##      404      571      174</span></span>
<span id="cb7-11"><a href="tutorial.html#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at the stop words in snowball</span></span>
<span id="cb7-12"><a href="tutorial.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stop_words[stop_words<span class="sc">$</span>lexicon <span class="sc">==</span> <span class="st">&quot;snowball&quot;</span>,],<span class="dv">15</span>)</span>
<span id="cb7-13"><a href="tutorial.html#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 15 × 2</span></span>
<span id="cb7-14"><a href="tutorial.html#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="do">##    word       lexicon </span></span>
<span id="cb7-15"><a href="tutorial.html#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;      &lt;chr&gt;   </span></span>
<span id="cb7-16"><a href="tutorial.html#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 i          snowball</span></span>
<span id="cb7-17"><a href="tutorial.html#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 me         snowball</span></span>
<span id="cb7-18"><a href="tutorial.html#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 my         snowball</span></span>
<span id="cb7-19"><a href="tutorial.html#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 myself     snowball</span></span>
<span id="cb7-20"><a href="tutorial.html#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 we         snowball</span></span>
<span id="cb7-21"><a href="tutorial.html#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 our        snowball</span></span>
<span id="cb7-22"><a href="tutorial.html#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 ours       snowball</span></span>
<span id="cb7-23"><a href="tutorial.html#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 ourselves  snowball</span></span>
<span id="cb7-24"><a href="tutorial.html#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 you        snowball</span></span>
<span id="cb7-25"><a href="tutorial.html#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 your       snowball</span></span>
<span id="cb7-26"><a href="tutorial.html#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 yours      snowball</span></span>
<span id="cb7-27"><a href="tutorial.html#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 yourself   snowball</span></span>
<span id="cb7-28"><a href="tutorial.html#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 yourselves snowball</span></span>
<span id="cb7-29"><a href="tutorial.html#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 he         snowball</span></span>
<span id="cb7-30"><a href="tutorial.html#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 him        snowball</span></span></code></pre></div>
<p>Remove the stop words from the tweets using <code>snowball</code>. The number of tokens decreased significantly.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="tutorial.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(text_df)<span class="co"># count before removal </span></span>
<span id="cb8-2"><a href="tutorial.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 94599</span></span>
<span id="cb8-3"><a href="tutorial.html#cb8-3" aria-hidden="true" tabindex="-1"></a>text_df <span class="ot">&lt;-</span> text_df <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="tutorial.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words[stop_words<span class="sc">$</span>lexicon <span class="sc">==</span> <span class="st">&quot;snowball&quot;</span>,], <span class="at">by =</span> <span class="st">&quot;word&quot;</span>)</span>
<span id="cb8-5"><a href="tutorial.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(text_df) <span class="co"># count after removal </span></span>
<span id="cb8-6"><a href="tutorial.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 54921</span></span></code></pre></div>
</div>
<div id="stemming" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Stemming<a href="tutorial.html#stemming" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we deal with text, often documents contain different versions of one base word, often called a stem. For example, the word “running” can be both “run” and “ran.” Over the last half-century, various algorithms for stemming words have been developed.</p>
<p>Stemming is frequently used in NLP pipelines, sometimes without any discussion of whether it is useful or not. We advise you to consider stemming as a preprocessing step in text modelling, one that must be carefully considered and chosen (or not).</p>
<p>Why does stemming frequently used when developing a machine learning model for text? It helps reduce the feature space of the text data. A common data structure for modeling is a matrix, more words mean higher sparsity of the data matrix.</p>
<blockquote>
<p><a href="https://smltar.com/stemming.html">Common sense says that reducing the number of word features in our data set so dramatically will improve the performance of any machine learning model we train with it,<em>assuming that we haven’t lost any important information by stemming</em>. There is a growing body of academic research demonstrating that stemming can be counterproductive for text modeling, such as topic modelling</a>.</p>
</blockquote>
<p>We used the <code>wordStem()</code> function in the <code>SnowballC</code> library to stem the words. The Unique words dropped after stemming.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="tutorial.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique count of words before stemming</span></span>
<span id="cb9-2"><a href="tutorial.html#cb9-2" aria-hidden="true" tabindex="-1"></a>text_df <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="tutorial.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="tutorial.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb9-5"><a href="tutorial.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 11400</span></span>
<span id="cb9-6"><a href="tutorial.html#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="tutorial.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># stemming</span></span>
<span id="cb9-8"><a href="tutorial.html#cb9-8" aria-hidden="true" tabindex="-1"></a>text_df <span class="ot">=</span> text_df <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="tutorial.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stem =</span> <span class="fu">wordStem</span>(word))</span>
<span id="cb9-10"><a href="tutorial.html#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="tutorial.html#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># unique count of words after stemming</span></span>
<span id="cb9-12"><a href="tutorial.html#cb9-12" aria-hidden="true" tabindex="-1"></a>text_df <span class="sc">%&gt;%</span></span>
<span id="cb9-13"><a href="tutorial.html#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(stem, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-14"><a href="tutorial.html#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() </span>
<span id="cb9-15"><a href="tutorial.html#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 8893</span></span></code></pre></div>
</div>
<div id="exporatory-data-analysis" class="section level3 hasAnchor" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Exporatory Data Analysis<a href="tutorial.html#exporatory-data-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Take a look at the most common words in the dataset.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="tutorial.html#cb10-1" aria-hidden="true" tabindex="-1"></a>text_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(word) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="tutorial.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="tutorial.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="tutorial.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb10-5"><a href="tutorial.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 10 × 2</span></span>
<span id="cb10-6"><a href="tutorial.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    word     count</span></span>
<span id="cb10-7"><a href="tutorial.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;    &lt;int&gt;</span></span>
<span id="cb10-8"><a href="tutorial.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 cough     1023</span></span>
<span id="cb10-9"><a href="tutorial.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 fever      653</span></span>
<span id="cb10-10"><a href="tutorial.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 headache   590</span></span>
<span id="cb10-11"><a href="tutorial.html#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 just       485</span></span>
<span id="cb10-12"><a href="tutorial.html#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 like       392</span></span>
<span id="cb10-13"><a href="tutorial.html#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 chills     388</span></span>
<span id="cb10-14"><a href="tutorial.html#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 fatigue    349</span></span>
<span id="cb10-15"><a href="tutorial.html#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 get        299</span></span>
<span id="cb10-16"><a href="tutorial.html#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 coughing   292</span></span>
<span id="cb10-17"><a href="tutorial.html#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 covid      284</span></span>
<span id="cb10-18"><a href="tutorial.html#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="tutorial.html#cb10-19" aria-hidden="true" tabindex="-1"></a>text_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(stem) <span class="sc">%&gt;%</span> </span>
<span id="cb10-20"><a href="tutorial.html#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb10-21"><a href="tutorial.html#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-22"><a href="tutorial.html#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb10-23"><a href="tutorial.html#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 10 × 2</span></span>
<span id="cb10-24"><a href="tutorial.html#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="do">##    stem    count</span></span>
<span id="cb10-25"><a href="tutorial.html#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;   &lt;int&gt;</span></span>
<span id="cb10-26"><a href="tutorial.html#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 cough    1467</span></span>
<span id="cb10-27"><a href="tutorial.html#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 headach   795</span></span>
<span id="cb10-28"><a href="tutorial.html#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 fever     670</span></span>
<span id="cb10-29"><a href="tutorial.html#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 just      485</span></span>
<span id="cb10-30"><a href="tutorial.html#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 like      421</span></span>
<span id="cb10-31"><a href="tutorial.html#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 fatigu    410</span></span>
<span id="cb10-32"><a href="tutorial.html#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 get       410</span></span>
<span id="cb10-33"><a href="tutorial.html#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 chill     402</span></span>
<span id="cb10-34"><a href="tutorial.html#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 dai       338</span></span>
<span id="cb10-35"><a href="tutorial.html#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 covid     284</span></span></code></pre></div>
<p>Create a bar chart displaying the words with &gt; 200 occurrence in the tweets.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="tutorial.html#cb11-1" aria-hidden="true" tabindex="-1"></a>text_df <span class="sc">%&gt;%</span> <span class="fu">count</span>(word, <span class="at">sort =</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="tutorial.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">200</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="tutorial.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">reorder</span>(word,n)) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="tutorial.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> word)) <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb11-5"><a href="tutorial.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Words with &gt; 200 occurrence in the tweets&quot;</span>)</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/edaaa-1.png" width="672" /></p>
<p>Compare the word frequencies with different annotation. Annotation is the outcome of interest.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="tutorial.html#cb12-1" aria-hidden="true" tabindex="-1"></a>frequency <span class="ot">&lt;-</span> text_df <span class="sc">%&gt;%</span> <span class="fu">count</span>(annotation, word) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(annotation) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="tutorial.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="tutorial.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> annotation, <span class="at">values_from =</span> proportion) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="tutorial.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">No =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="tutorial.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">3</span>,<span class="at">names_to =</span><span class="st">&quot;Yes&quot;</span>,<span class="at">values_to =</span> <span class="st">&quot;proportion&quot;</span>)</span>
<span id="cb12-6"><a href="tutorial.html#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="tutorial.html#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="tutorial.html#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># expect a warning about rows with missing values being removed</span></span>
<span id="cb12-9"><a href="tutorial.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(frequency, <span class="fu">aes</span>(<span class="at">x =</span> proportion, <span class="at">y =</span> No,<span class="at">color =</span> <span class="fu">abs</span>(No <span class="sc">-</span> proportion)))<span class="sc">+</span></span>
<span id="cb12-10"><a href="tutorial.html#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">&quot;gray40&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="tutorial.html#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb12-12"><a href="tutorial.html#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> word), <span class="at">check_overlap =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb12-13"><a href="tutorial.html#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb12-14"><a href="tutorial.html#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb12-15"><a href="tutorial.html#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.001</span>),</span>
<span id="cb12-16"><a href="tutorial.html#cb12-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">low =</span> <span class="st">&quot;darkslategray4&quot;</span>, <span class="at">high =</span> <span class="st">&quot;gray75&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-17"><a href="tutorial.html#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-18"><a href="tutorial.html#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;No&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Yes&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Comparing the Word Frequencies of Different Annotation&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Words far from the line are words found more in one set of texts than another&quot;</span>)</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/edac-1.png" width="672" /></p>
<p>Words that are close to the line in these plots have similar frequencies in both sets of texts. Words that are far from the line are words that are found more in one set of texts than another.</p>
<p>We can quantify how similar (or different) the set of word frequencies using a <a href="https://bookdown.org/ndphillips/YaRrr/correlation-cor-test.html">correlation test</a></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="tutorial.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(<span class="at">data =</span> frequency[frequency<span class="sc">$</span>Yes <span class="sc">==</span> <span class="dv">1</span>,], <span class="sc">~</span> proportion <span class="sc">+</span> <span class="st">`</span><span class="at">No</span><span class="st">`</span>)</span>
<span id="cb13-2"><a href="tutorial.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-3"><a href="tutorial.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  Pearson&#39;s product-moment correlation</span></span>
<span id="cb13-4"><a href="tutorial.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-5"><a href="tutorial.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="do">## data:  proportion and No</span></span>
<span id="cb13-6"><a href="tutorial.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="do">## t = 51.611, df = 1350, p-value &lt; 2.2e-16</span></span>
<span id="cb13-7"><a href="tutorial.html#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">## alternative hypothesis: true correlation is not equal to 0</span></span>
<span id="cb13-8"><a href="tutorial.html#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 95 percent confidence interval:</span></span>
<span id="cb13-9"><a href="tutorial.html#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.7959026 0.8318336</span></span>
<span id="cb13-10"><a href="tutorial.html#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="do">## sample estimates:</span></span>
<span id="cb13-11"><a href="tutorial.html#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="do">##       cor </span></span>
<span id="cb13-12"><a href="tutorial.html#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 0.8146484</span></span></code></pre></div>
</div>
</div>
<div id="classification-models" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Classification Models<a href="tutorial.html#classification-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Most supervised models for text data are built with one of <strong>three purposes</strong> in mind:</p>
<ul>
<li><strong>predictive model:</strong> generate the most accurate predictions possible.</li>
<li><strong>inferential model:</strong> hypothesis testing or draw a conclusion about a population.</li>
<li><strong>descriptive model</strong>: describe the properties of the observed data.</li>
</ul>
<p>We will use the <a href="https://www.tidymodels.org/">tidymodels</a> framework for this tutorial.</p>
<blockquote>
<p>The <code>tidymodels</code> framework(<a href="https://smltar.com/mloverview.html#ref-R-tidymodels">Kuhn and Wickham 2021a</a>) is a collection of R packages for modeling and machine learning using <code>tidyverse</code> principles (Wickham et al. 2019).</p>
</blockquote>
<p>Depending on the outcome of interest:</p>
<ul>
<li>A <strong>classification model</strong> predicts a class label or group membership.</li>
<li>A <strong>regression model</strong> predicts a numeric or continuous value.</li>
</ul>
<p><strong>We will use classification model for this tutorial, as our outcome is a binary class label.</strong></p>
<div id="split-the-training-and-test-set" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Split the Training and Test Set<a href="tutorial.html#split-the-training-and-test-set" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is normal practice to split an existing data set into two subsets, the training and test sets. For the most part, we use the training set for model development, feature engineering, and so on.</p>
<p>We made use of the <code>initial_split()</code> function in the <a href="https://rsample.tidymodels.org/">rsample</a> package. We will create a factor <code>outcome</code> variable with two levels.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="tutorial.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve conflicts between tidymodels packages and others</span></span>
<span id="cb14-2"><a href="tutorial.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb14-3"><a href="tutorial.html#cb14-3" aria-hidden="true" tabindex="-1"></a>tweetsDF2class <span class="ot">&lt;-</span> tweetsDF <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="tutorial.html#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">outcome =</span> <span class="fu">factor</span>(annotation)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="tutorial.html#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(outcome))</span>
<span id="cb14-6"><a href="tutorial.html#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="tutorial.html#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># default 3/4 for training and 1/4 for testing</span></span>
<span id="cb14-8"><a href="tutorial.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># use `strata` argument to specify stratified random sampling.</span></span>
<span id="cb14-9"><a href="tutorial.html#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use `set.seed()` to reproduce the results later. </span></span>
<span id="cb14-10"><a href="tutorial.html#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb14-11"><a href="tutorial.html#cb14-11" aria-hidden="true" tabindex="-1"></a>tweet_df_split <span class="ot">&lt;-</span> tweetsDF2class <span class="sc">%&gt;%</span> <span class="fu">initial_split</span>(<span class="fl">0.7</span>, <span class="at">strata =</span> outcome)</span>
<span id="cb14-12"><a href="tutorial.html#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the training set</span></span>
<span id="cb14-13"><a href="tutorial.html#cb14-13" aria-hidden="true" tabindex="-1"></a>tweet_df_train <span class="ot">&lt;-</span> <span class="fu">training</span>(tweet_df_split)</span>
<span id="cb14-14"><a href="tutorial.html#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tweet_df_train<span class="sc">$</span>outcome)</span>
<span id="cb14-15"><a href="tutorial.html#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-16"><a href="tutorial.html#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="do">##    0    1 </span></span>
<span id="cb14-17"><a href="tutorial.html#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 3869  309</span></span>
<span id="cb14-18"><a href="tutorial.html#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># the test set</span></span>
<span id="cb14-19"><a href="tutorial.html#cb14-19" aria-hidden="true" tabindex="-1"></a>tweet_df_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(tweet_df_split)</span>
<span id="cb14-20"><a href="tutorial.html#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tweet_df_test<span class="sc">$</span>outcome)</span>
<span id="cb14-21"><a href="tutorial.html#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-22"><a href="tutorial.html#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="do">##    0    1 </span></span>
<span id="cb14-23"><a href="tutorial.html#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 1661  130</span></span>
<span id="cb14-24"><a href="tutorial.html#cb14-24" aria-hidden="true" tabindex="-1"></a>tweet_df_split</span>
<span id="cb14-25"><a href="tutorial.html#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;Training/Testing/Total&gt;</span></span>
<span id="cb14-26"><a href="tutorial.html#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="do">## &lt;4178/1791/5969&gt;</span></span></code></pre></div>
</div>
<div id="pre-processing-with-the-recipe" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Pre-processing with the <code>recipe()</code><a href="tutorial.html#pre-processing-with-the-recipe" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A <code>recipe</code> is a powerful preprocessor for modelling, and can be added to a <code>workflow</code> pipeline.</p>
<p><strong>Our recipe is the plan of action, add <code>step_*()</code> to our recipe.</strong></p>
<p>Specify the model form in the the <code>recipe()</code> statement with the formula. Then tokenize the text of the tweets.</p>
<p>The recipe step <code>step_tfidf()</code> weights each token frequency by inverse document frequency (IDF). As the preprocessing might be model dependent, so you can create different recipes.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="tutorial.html#cb15-1" aria-hidden="true" tabindex="-1"></a>tweet_rec <span class="ot">&lt;-</span><span class="fu">recipe</span>(outcome <span class="sc">~</span> processed_tweet, <span class="at">data =</span> tweet_df_train) <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="tutorial.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenize</span>(processed_tweet) <span class="sc">%&gt;%</span> <span class="co"># tokenization</span></span>
<span id="cb15-3"><a href="tutorial.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_stopwords</span>(processed_tweet)<span class="sc">%&gt;%</span> <span class="co"># stopwords removal</span></span>
<span id="cb15-4"><a href="tutorial.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_stem</span>(processed_tweet) <span class="sc">%&gt;%</span> <span class="co">#stem</span></span>
<span id="cb15-5"><a href="tutorial.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenfilter</span>(processed_tweet, <span class="at">max_tokens =</span> <span class="fl">1e3</span>) <span class="sc">%&gt;%</span> <span class="co"># select tokens</span></span>
<span id="cb15-6"><a href="tutorial.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tfidf</span>(processed_tweet) <span class="co"># convert to tf-idf</span></span>
<span id="cb15-7"><a href="tutorial.html#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="tutorial.html#cb15-8" aria-hidden="true" tabindex="-1"></a>tweet_rec <span class="co"># a recipe</span></span>
<span id="cb15-9"><a href="tutorial.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Recipe</span></span>
<span id="cb15-10"><a href="tutorial.html#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-11"><a href="tutorial.html#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Inputs:</span></span>
<span id="cb15-12"><a href="tutorial.html#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-13"><a href="tutorial.html#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="do">##       role #variables</span></span>
<span id="cb15-14"><a href="tutorial.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="do">##    outcome          1</span></span>
<span id="cb15-15"><a href="tutorial.html#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  predictor          1</span></span>
<span id="cb15-16"><a href="tutorial.html#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-17"><a href="tutorial.html#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Operations:</span></span>
<span id="cb15-18"><a href="tutorial.html#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-19"><a href="tutorial.html#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Tokenization for processed_tweet</span></span>
<span id="cb15-20"><a href="tutorial.html#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Stop word removal for processed_tweet</span></span>
<span id="cb15-21"><a href="tutorial.html#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Stemming for processed_tweet</span></span>
<span id="cb15-22"><a href="tutorial.html#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Text filtering for processed_tweet</span></span>
<span id="cb15-23"><a href="tutorial.html#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Term frequency-inverse document frequency with processed_tweet</span></span></code></pre></div>
<p>In case there is significant imbalance between the classes, we can address it during data preprocessing using the <code>themis</code> package. You can add <code>step_downsample()</code> or <code>stemp_upsample()</code> in the recipe specification to deal with the issue.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="tutorial.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tweet_df_train<span class="sc">$</span>outcome) <span class="co"># 7.4% of tweets are labeled as “1”. </span></span>
<span id="cb16-2"><a href="tutorial.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-3"><a href="tutorial.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    0    1 </span></span>
<span id="cb16-4"><a href="tutorial.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3869  309</span></span>
<span id="cb16-5"><a href="tutorial.html#cb16-5" aria-hidden="true" tabindex="-1"></a>tweet_upsample_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(outcome <span class="sc">~</span> processed_tweet, </span>
<span id="cb16-6"><a href="tutorial.html#cb16-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> tweet_df_train) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="tutorial.html#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenize</span>(processed_tweet) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="tutorial.html#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_stopwords</span>(processed_tweet)<span class="sc">%&gt;%</span></span>
<span id="cb16-9"><a href="tutorial.html#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_stem</span>(processed_tweet) <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="tutorial.html#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tokenfilter</span>(processed_tweet, <span class="at">max_tokens =</span> <span class="fl">1e3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-11"><a href="tutorial.html#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_tfidf</span>(processed_tweet) <span class="sc">%&gt;%</span></span>
<span id="cb16-12"><a href="tutorial.html#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_upsample</span>(outcome, <span class="at">over_ratio =</span> <span class="dv">1</span>)</span>
<span id="cb16-13"><a href="tutorial.html#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="tutorial.html#cb16-14" aria-hidden="true" tabindex="-1"></a>tweet_upsample_rec <span class="co"># a recipe with upsample</span></span>
<span id="cb16-15"><a href="tutorial.html#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Recipe</span></span>
<span id="cb16-16"><a href="tutorial.html#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-17"><a href="tutorial.html#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Inputs:</span></span>
<span id="cb16-18"><a href="tutorial.html#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-19"><a href="tutorial.html#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="do">##       role #variables</span></span>
<span id="cb16-20"><a href="tutorial.html#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="do">##    outcome          1</span></span>
<span id="cb16-21"><a href="tutorial.html#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  predictor          1</span></span>
<span id="cb16-22"><a href="tutorial.html#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-23"><a href="tutorial.html#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Operations:</span></span>
<span id="cb16-24"><a href="tutorial.html#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-25"><a href="tutorial.html#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Tokenization for processed_tweet</span></span>
<span id="cb16-26"><a href="tutorial.html#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Stop word removal for processed_tweet</span></span>
<span id="cb16-27"><a href="tutorial.html#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Stemming for processed_tweet</span></span>
<span id="cb16-28"><a href="tutorial.html#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Text filtering for processed_tweet</span></span>
<span id="cb16-29"><a href="tutorial.html#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Term frequency-inverse document frequency with processed_tweet</span></span>
<span id="cb16-30"><a href="tutorial.html#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Up-sampling based on outcome</span></span></code></pre></div>
</div>
<div id="choose-a-classification-model" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Choose a Classification Model<a href="tutorial.html#choose-a-classification-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Choose a classification model using the <code>parsnip</code> package, find a classification model <a href="https://www.tidymodels.org/find/parsnip/" class="uri">https://www.tidymodels.org/find/parsnip/</a></p>
<p>We demonstrate a naive Bayes model and Lasso Regularized Generalized Linear Models (GLMs) for the classification task.</p>
<ul>
<li><p>Naive Bayes model can handle a large number of features quite well. We will kept the 1000 most frequent tokens for now. We use the the naive Bayes model from the <code>discrim</code> package.</p></li>
<li><p>Regularized linear models are often used and are workhorse in real-world practice.</p></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="tutorial.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Naive Bayes model</span></span>
<span id="cb17-2"><a href="tutorial.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the engine usually refers a R model package</span></span>
<span id="cb17-3"><a href="tutorial.html#cb17-3" aria-hidden="true" tabindex="-1"></a>nb_spec <span class="ot">&lt;-</span> <span class="fu">naive_Bayes</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="tutorial.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="tutorial.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;naivebayes&quot;</span>) </span>
<span id="cb17-6"><a href="tutorial.html#cb17-6" aria-hidden="true" tabindex="-1"></a>nb_spec</span>
<span id="cb17-7"><a href="tutorial.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Naive Bayes Model Specification (classification)</span></span>
<span id="cb17-8"><a href="tutorial.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-9"><a href="tutorial.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Computational engine: naivebayes</span></span>
<span id="cb17-10"><a href="tutorial.html#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="tutorial.html#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="tutorial.html#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Regularized linear models</span></span>
<span id="cb17-13"><a href="tutorial.html#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># you can tune the parameters, but we will start from these values. </span></span>
<span id="cb17-14"><a href="tutorial.html#cb17-14" aria-hidden="true" tabindex="-1"></a>lasso_spec <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">penalty =</span> <span class="fl">0.01</span>, <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-15"><a href="tutorial.html#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-16"><a href="tutorial.html#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb17-17"><a href="tutorial.html#cb17-17" aria-hidden="true" tabindex="-1"></a>lasso_spec</span>
<span id="cb17-18"><a href="tutorial.html#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Logistic Regression Model Specification (classification)</span></span>
<span id="cb17-19"><a href="tutorial.html#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-20"><a href="tutorial.html#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Main Arguments:</span></span>
<span id="cb17-21"><a href="tutorial.html#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   penalty = 0.01</span></span>
<span id="cb17-22"><a href="tutorial.html#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="do">##   mixture = 1</span></span>
<span id="cb17-23"><a href="tutorial.html#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-24"><a href="tutorial.html#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Computational engine: glmnet</span></span></code></pre></div>
</div>
<div id="the-workflow-for-bundling-recipe-and-models" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> The <code>workflow()</code> for bundling <code>recipe()</code> and models<a href="tutorial.html#the-workflow-for-bundling-recipe-and-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>workflows</code> package easily allow users to bind preprocessing objects with modelling together. A workflow requires a <code>parsnip</code> model object.</p>
<blockquote>
<p>In <strong>tidymodels</strong>, the <strong>workflows</strong> package (<a href="https://smltar.com/mlregression.html#ref-R-workflows">Vaughan 2021b</a>) offers infrastructure for bundling model components. A <em>model workflow</em> is a convenient way to combine different modeling components (a preprocessor plus a model specification); when these are bundled explicitly, it can be easier to keep track of your modeling plan, as well as fit your model and predict on new data. <span class="citation">(<a href="#ref-Hvitfeldt2022-hm" role="doc-biblioref">Hvitfeldt and Silge 2022</a>)</span></p>
</blockquote>
<p>A workflow can have the following components:</p>
<ul>
<li>a <code>receipe()</code> with formula and pre-process.</li>
<li>a model specification, <code>add_model()</code></li>
<li>a training dataset, e.g. <code>fit(data=training)</code></li>
</ul>
<p>Let’s add the recipe and the model to the workflow.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="tutorial.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create workf lo</span></span>
<span id="cb18-2"><a href="tutorial.html#cb18-2" aria-hidden="true" tabindex="-1"></a>nb_wf <span class="ot">=</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="tutorial.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(tweet_rec)<span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="tutorial.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(nb_spec)</span>
<span id="cb18-5"><a href="tutorial.html#cb18-5" aria-hidden="true" tabindex="-1"></a>nb_wf</span>
<span id="cb18-6"><a href="tutorial.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ══ Workflow ════════════════════════════════════════════════════════════════════</span></span>
<span id="cb18-7"><a href="tutorial.html#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Preprocessor: Recipe</span></span>
<span id="cb18-8"><a href="tutorial.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: naive_Bayes()</span></span>
<span id="cb18-9"><a href="tutorial.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-10"><a href="tutorial.html#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span id="cb18-11"><a href="tutorial.html#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Recipe Steps</span></span>
<span id="cb18-12"><a href="tutorial.html#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-13"><a href="tutorial.html#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tokenize()</span></span>
<span id="cb18-14"><a href="tutorial.html#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_stopwords()</span></span>
<span id="cb18-15"><a href="tutorial.html#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_stem()</span></span>
<span id="cb18-16"><a href="tutorial.html#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tokenfilter()</span></span>
<span id="cb18-17"><a href="tutorial.html#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tfidf()</span></span>
<span id="cb18-18"><a href="tutorial.html#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-19"><a href="tutorial.html#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span id="cb18-20"><a href="tutorial.html#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Naive Bayes Model Specification (classification)</span></span>
<span id="cb18-21"><a href="tutorial.html#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-22"><a href="tutorial.html#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Computational engine: naivebayes</span></span>
<span id="cb18-23"><a href="tutorial.html#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="tutorial.html#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co"># workflow with upsampling pre-processing</span></span>
<span id="cb18-25"><a href="tutorial.html#cb18-25" aria-hidden="true" tabindex="-1"></a>lasso_wf <span class="ot">=</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-26"><a href="tutorial.html#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(tweet_rec)<span class="sc">%&gt;%</span></span>
<span id="cb18-27"><a href="tutorial.html#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_spec) </span>
<span id="cb18-28"><a href="tutorial.html#cb18-28" aria-hidden="true" tabindex="-1"></a>lasso_wf</span>
<span id="cb18-29"><a href="tutorial.html#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="do">## ══ Workflow ════════════════════════════════════════════════════════════════════</span></span>
<span id="cb18-30"><a href="tutorial.html#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Preprocessor: Recipe</span></span>
<span id="cb18-31"><a href="tutorial.html#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: logistic_reg()</span></span>
<span id="cb18-32"><a href="tutorial.html#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-33"><a href="tutorial.html#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span id="cb18-34"><a href="tutorial.html#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Recipe Steps</span></span>
<span id="cb18-35"><a href="tutorial.html#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-36"><a href="tutorial.html#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tokenize()</span></span>
<span id="cb18-37"><a href="tutorial.html#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_stopwords()</span></span>
<span id="cb18-38"><a href="tutorial.html#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_stem()</span></span>
<span id="cb18-39"><a href="tutorial.html#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tokenfilter()</span></span>
<span id="cb18-40"><a href="tutorial.html#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tfidf()</span></span>
<span id="cb18-41"><a href="tutorial.html#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-42"><a href="tutorial.html#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span id="cb18-43"><a href="tutorial.html#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="do">## Logistic Regression Model Specification (classification)</span></span>
<span id="cb18-44"><a href="tutorial.html#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-45"><a href="tutorial.html#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Main Arguments:</span></span>
<span id="cb18-46"><a href="tutorial.html#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="do">##   penalty = 0.01</span></span>
<span id="cb18-47"><a href="tutorial.html#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="do">##   mixture = 1</span></span>
<span id="cb18-48"><a href="tutorial.html#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-49"><a href="tutorial.html#cb18-49" aria-hidden="true" tabindex="-1"></a><span class="do">## Computational engine: glmnet</span></span></code></pre></div>
<p>Create a <code>workflow()</code>, then <code>add_recipe()</code> and <code>add_model()</code> to <code>fit()</code> the training data as a whole and <code>predict()</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="tutorial.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># it takes a long time to finish</span></span>
<span id="cb19-2"><a href="tutorial.html#cb19-2" aria-hidden="true" tabindex="-1"></a>nb_fit <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="tutorial.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(tweet_rec)<span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="tutorial.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(nb_spec) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="tutorial.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> tweet_df_train)</span>
<span id="cb19-6"><a href="tutorial.html#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="tutorial.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># predict() on the fitted workflow</span></span>
<span id="cb19-8"><a href="tutorial.html#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(nb_fit, tweet_df_test <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="cb19-9"><a href="tutorial.html#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="tutorial.html#cb19-10" aria-hidden="true" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-11"><a href="tutorial.html#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(tweet_rec)<span class="sc">%&gt;%</span></span>
<span id="cb19-12"><a href="tutorial.html#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_spec) <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="tutorial.html#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> tweet_df_train)</span></code></pre></div>
<p>we fit one time to the training data as a whole, but often this is not enough. We need to evaluate our model or tune the parameters to find models with better performance.</p>
</div>
<div id="model-evaluation" class="section level3 hasAnchor" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> Model Evaluation<a href="tutorial.html#model-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When comparing models or model parameters, we should not use the test set for this purpose. After the model has been trained, the test set should only be used to estimate how well the model will perform on new data. Resampling approaches should be used for model evaluation. We can resample data sets built from the training set by creating n-fold cross-validation sets.</p>
<p>Let’s create a 3-fold cross-validation set.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="tutorial.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a 3-fold cross-validation set.</span></span>
<span id="cb20-2"><a href="tutorial.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb20-3"><a href="tutorial.html#cb20-3" aria-hidden="true" tabindex="-1"></a>tweet_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(tweet_df_train, <span class="at">v =</span> <span class="dv">3</span>)</span>
<span id="cb20-4"><a href="tutorial.html#cb20-4" aria-hidden="true" tabindex="-1"></a>tweet_folds</span>
<span id="cb20-5"><a href="tutorial.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="do">## #  3-fold cross-validation </span></span>
<span id="cb20-6"><a href="tutorial.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 × 2</span></span>
<span id="cb20-7"><a href="tutorial.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   splits              id   </span></span>
<span id="cb20-8"><a href="tutorial.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;list&gt;              &lt;chr&gt;</span></span>
<span id="cb20-9"><a href="tutorial.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 &lt;split [2785/1393]&gt; Fold1</span></span>
<span id="cb20-10"><a href="tutorial.html#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 &lt;split [2785/1393]&gt; Fold2</span></span>
<span id="cb20-11"><a href="tutorial.html#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 &lt;split [2786/1392]&gt; Fold3</span></span></code></pre></div>
<p>Using lasso classification model for demonstration, suppose we want to compare model performance (with or without up-sampling). Create our workflows for different pre-processing (with or without up-sampling)</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="tutorial.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create two workflow with different recipes</span></span>
<span id="cb21-2"><a href="tutorial.html#cb21-2" aria-hidden="true" tabindex="-1"></a>lasso_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="tutorial.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(tweet_rec) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="tutorial.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_spec)</span>
<span id="cb21-5"><a href="tutorial.html#cb21-5" aria-hidden="true" tabindex="-1"></a>lasso_wf</span>
<span id="cb21-6"><a href="tutorial.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ══ Workflow ════════════════════════════════════════════════════════════════════</span></span>
<span id="cb21-7"><a href="tutorial.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Preprocessor: Recipe</span></span>
<span id="cb21-8"><a href="tutorial.html#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: logistic_reg()</span></span>
<span id="cb21-9"><a href="tutorial.html#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-10"><a href="tutorial.html#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span id="cb21-11"><a href="tutorial.html#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Recipe Steps</span></span>
<span id="cb21-12"><a href="tutorial.html#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-13"><a href="tutorial.html#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tokenize()</span></span>
<span id="cb21-14"><a href="tutorial.html#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_stopwords()</span></span>
<span id="cb21-15"><a href="tutorial.html#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_stem()</span></span>
<span id="cb21-16"><a href="tutorial.html#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tokenfilter()</span></span>
<span id="cb21-17"><a href="tutorial.html#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tfidf()</span></span>
<span id="cb21-18"><a href="tutorial.html#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-19"><a href="tutorial.html#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span id="cb21-20"><a href="tutorial.html#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Logistic Regression Model Specification (classification)</span></span>
<span id="cb21-21"><a href="tutorial.html#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-22"><a href="tutorial.html#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Main Arguments:</span></span>
<span id="cb21-23"><a href="tutorial.html#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="do">##   penalty = 0.01</span></span>
<span id="cb21-24"><a href="tutorial.html#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="do">##   mixture = 1</span></span>
<span id="cb21-25"><a href="tutorial.html#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-26"><a href="tutorial.html#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Computational engine: glmnet</span></span>
<span id="cb21-27"><a href="tutorial.html#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="tutorial.html#cb21-28" aria-hidden="true" tabindex="-1"></a>lasso_upsample_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-29"><a href="tutorial.html#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(tweet_upsample_rec) <span class="sc">%&gt;%</span></span>
<span id="cb21-30"><a href="tutorial.html#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_spec)</span>
<span id="cb21-31"><a href="tutorial.html#cb21-31" aria-hidden="true" tabindex="-1"></a>lasso_upsample_wf</span>
<span id="cb21-32"><a href="tutorial.html#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="do">## ══ Workflow ════════════════════════════════════════════════════════════════════</span></span>
<span id="cb21-33"><a href="tutorial.html#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="do">## Preprocessor: Recipe</span></span>
<span id="cb21-34"><a href="tutorial.html#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Model: logistic_reg()</span></span>
<span id="cb21-35"><a href="tutorial.html#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-36"><a href="tutorial.html#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Preprocessor ────────────────────────────────────────────────────────────────</span></span>
<span id="cb21-37"><a href="tutorial.html#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Recipe Steps</span></span>
<span id="cb21-38"><a href="tutorial.html#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-39"><a href="tutorial.html#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tokenize()</span></span>
<span id="cb21-40"><a href="tutorial.html#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_stopwords()</span></span>
<span id="cb21-41"><a href="tutorial.html#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_stem()</span></span>
<span id="cb21-42"><a href="tutorial.html#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tokenfilter()</span></span>
<span id="cb21-43"><a href="tutorial.html#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_tfidf()</span></span>
<span id="cb21-44"><a href="tutorial.html#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="do">## • step_upsample()</span></span>
<span id="cb21-45"><a href="tutorial.html#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-46"><a href="tutorial.html#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Model ───────────────────────────────────────────────────────────────────────</span></span>
<span id="cb21-47"><a href="tutorial.html#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="do">## Logistic Regression Model Specification (classification)</span></span>
<span id="cb21-48"><a href="tutorial.html#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-49"><a href="tutorial.html#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="do">## Main Arguments:</span></span>
<span id="cb21-50"><a href="tutorial.html#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="do">##   penalty = 0.01</span></span>
<span id="cb21-51"><a href="tutorial.html#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="do">##   mixture = 1</span></span>
<span id="cb21-52"><a href="tutorial.html#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb21-53"><a href="tutorial.html#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="do">## Computational engine: glmnet</span></span></code></pre></div>
<p>We fit the model multiple times, once to each of these re-sampled folds, and then evaluate on the left part for each re-sampled fold.</p>
<p>This also takes a long time to finish.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="tutorial.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># without upsampling (imbalanced data)</span></span>
<span id="cb22-2"><a href="tutorial.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb22-3"><a href="tutorial.html#cb22-3" aria-hidden="true" tabindex="-1"></a>lasso_rs <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(</span>
<span id="cb22-4"><a href="tutorial.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  lasso_wf,</span>
<span id="cb22-5"><a href="tutorial.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  tweet_folds,</span>
<span id="cb22-6"><a href="tutorial.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span>
<span id="cb22-7"><a href="tutorial.html#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="tutorial.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># with upsampling</span></span>
<span id="cb22-9"><a href="tutorial.html#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb22-10"><a href="tutorial.html#cb22-10" aria-hidden="true" tabindex="-1"></a>lasso_upsample_rs <span class="ot">&lt;-</span> <span class="fu">fit_resamples</span>(</span>
<span id="cb22-11"><a href="tutorial.html#cb22-11" aria-hidden="true" tabindex="-1"></a>  lasso_upsample_wf,</span>
<span id="cb22-12"><a href="tutorial.html#cb22-12" aria-hidden="true" tabindex="-1"></a>  tweet_folds,</span>
<span id="cb22-13"><a href="tutorial.html#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div id="accuracy-and-roc-auc" class="section level4 hasAnchor" number="2.3.5.1">
<h4><span class="header-section-number">2.3.5.1</span> Accuracy and ROC AUC<a href="tutorial.html#accuracy-and-roc-auc" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The default performance measures for binary classification are accuracy and ROC AUC (area under the receiver operator characteristic curve).</p>
<blockquote>
<p>Accuracy and ROC AUC are performance metrics used for classification models. For both, values closer to 1 are better. Accuracy is the proportion of the data that is predicted correctly. Be aware that accuracy can be misleading in some situations, such as for imbalanced data sets.ROC AUC measures how well a classifier performs at different thresholds. The ROC curve plots the true positive rate against the false positive rate; AUC closer to 1 indicates a better-performing model, while AUC closer to 0.5 indicates a model that does no better than random guessing.<span class="citation">(<a href="#ref-Hvitfeldt2022-hm" role="doc-biblioref">Hvitfeldt and Silge 2022</a>)</span></p>
</blockquote>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="tutorial.html#cb23-1" aria-hidden="true" tabindex="-1"></a>lasso_rs_metrics <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(lasso_rs)</span>
<span id="cb23-2"><a href="tutorial.html#cb23-2" aria-hidden="true" tabindex="-1"></a>lasso_rs_predictions <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(lasso_rs)</span>
<span id="cb23-3"><a href="tutorial.html#cb23-3" aria-hidden="true" tabindex="-1"></a>lasso_rs_metrics</span>
<span id="cb23-4"><a href="tutorial.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 6</span></span>
<span id="cb23-5"><a href="tutorial.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   .metric  .estimator  mean     n std_err .config             </span></span>
<span id="cb23-6"><a href="tutorial.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb23-7"><a href="tutorial.html#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 accuracy binary     0.922     3 0.00334 Preprocessor1_Model1</span></span>
<span id="cb23-8"><a href="tutorial.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 roc_auc  binary     0.793     3 0.00329 Preprocessor1_Model1</span></span>
<span id="cb23-9"><a href="tutorial.html#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="tutorial.html#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the roc curve</span></span>
<span id="cb23-11"><a href="tutorial.html#cb23-11" aria-hidden="true" tabindex="-1"></a>lasso_rs_predictions <span class="sc">%&gt;%</span></span>
<span id="cb23-12"><a href="tutorial.html#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="tutorial.html#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> outcome, .pred_1, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="tutorial.html#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb23-15"><a href="tutorial.html#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-16"><a href="tutorial.html#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb23-17"><a href="tutorial.html#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;ROC curve (lasso, no upsampling)&quot;</span>,</span>
<span id="cb23-18"><a href="tutorial.html#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Each resample fold is shown in a different color&quot;</span></span>
<span id="cb23-19"><a href="tutorial.html#cb23-19" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/evalplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="tutorial.html#cb24-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2"><a href="tutorial.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the precision-recall curve</span></span>
<span id="cb24-3"><a href="tutorial.html#cb24-3" aria-hidden="true" tabindex="-1"></a>lasso_rs_predictions <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="tutorial.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="tutorial.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pr_curve</span>(<span class="at">truth =</span> outcome, .pred_1, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="tutorial.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()<span class="sc">+</span></span>
<span id="cb24-7"><a href="tutorial.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-8"><a href="tutorial.html#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb24-9"><a href="tutorial.html#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Precision Recall curve (lasso, no upsampling)&quot;</span>,</span>
<span id="cb24-10"><a href="tutorial.html#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Each resample fold is shown in a different color&quot;</span></span>
<span id="cb24-11"><a href="tutorial.html#cb24-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/evalplot-2.png" width="672" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="tutorial.html#cb25-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2"><a href="tutorial.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb25-3"><a href="tutorial.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat_resampled</span>(lasso_rs, <span class="at">tidy =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="tutorial.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">&quot;heatmap&quot;</span>)</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/evalplot-3.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="tutorial.html#cb26-1" aria-hidden="true" tabindex="-1"></a>lasso_up_rs_metrics <span class="ot">&lt;-</span> <span class="fu">collect_metrics</span>(lasso_upsample_rs)</span>
<span id="cb26-2"><a href="tutorial.html#cb26-2" aria-hidden="true" tabindex="-1"></a>lasso_up_rs_predictions <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(lasso_upsample_rs)</span>
<span id="cb26-3"><a href="tutorial.html#cb26-3" aria-hidden="true" tabindex="-1"></a>lasso_up_rs_metrics</span>
<span id="cb26-4"><a href="tutorial.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 6</span></span>
<span id="cb26-5"><a href="tutorial.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   .metric  .estimator  mean     n std_err .config             </span></span>
<span id="cb26-6"><a href="tutorial.html#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb26-7"><a href="tutorial.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 accuracy binary     0.835     3 0.00569 Preprocessor1_Model1</span></span>
<span id="cb26-8"><a href="tutorial.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 roc_auc  binary     0.815     3 0.0102  Preprocessor1_Model1</span></span>
<span id="cb26-9"><a href="tutorial.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the roc curve</span></span>
<span id="cb26-10"><a href="tutorial.html#cb26-10" aria-hidden="true" tabindex="-1"></a>lasso_up_rs_predictions <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="tutorial.html#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb26-12"><a href="tutorial.html#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> outcome, .pred_1, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-13"><a href="tutorial.html#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb26-14"><a href="tutorial.html#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-15"><a href="tutorial.html#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb26-16"><a href="tutorial.html#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;ROC curve for (lasso, upsampling)&quot;</span>,</span>
<span id="cb26-17"><a href="tutorial.html#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Each resample fold is shown in a different color&quot;</span></span>
<span id="cb26-18"><a href="tutorial.html#cb26-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/evalplot2-1.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="tutorial.html#cb27-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-2"><a href="tutorial.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the precision-recall curve</span></span>
<span id="cb27-3"><a href="tutorial.html#cb27-3" aria-hidden="true" tabindex="-1"></a>lasso_up_rs_predictions <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="tutorial.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="tutorial.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pr_curve</span>(<span class="at">truth =</span> outcome, .pred_1, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="tutorial.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()<span class="sc">+</span></span>
<span id="cb27-7"><a href="tutorial.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-8"><a href="tutorial.html#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb27-9"><a href="tutorial.html#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Precision Recall (lasso, upsampling)&quot;</span>,</span>
<span id="cb27-10"><a href="tutorial.html#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Each resample fold is shown in a different color&quot;</span></span>
<span id="cb27-11"><a href="tutorial.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/evalplot2-2.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="tutorial.html#cb28-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-2"><a href="tutorial.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb28-3"><a href="tutorial.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat_resampled</span>(lasso_upsample_rs, <span class="at">tidy =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="tutorial.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">&quot;heatmap&quot;</span>)</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/evalplot2-3.png" width="672" /></p>
<p>The lasso classification model with upsampling give us better model performance in terms of ROC AUC.</p>
</div>
<div id="compare-to-the-a-null-model" class="section level4 hasAnchor" number="2.3.5.2">
<h4><span class="header-section-number">2.3.5.2</span> Compare to the a NULL model<a href="tutorial.html#compare-to-the-a-null-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can assess a model by comparing its performance with a “null model” or baseline model.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="tutorial.html#cb29-1" aria-hidden="true" tabindex="-1"></a>null_classification <span class="ot">&lt;-</span> <span class="fu">null_model</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="tutorial.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;parsnip&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="tutorial.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span>
<span id="cb29-4"><a href="tutorial.html#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="tutorial.html#cb29-5" aria-hidden="true" tabindex="-1"></a>null_rs <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="tutorial.html#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(tweet_rec) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="tutorial.html#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(null_classification) <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="tutorial.html#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(</span>
<span id="cb29-9"><a href="tutorial.html#cb29-9" aria-hidden="true" tabindex="-1"></a>    tweet_folds,<span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-10"><a href="tutorial.html#cb29-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-11"><a href="tutorial.html#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="tutorial.html#cb29-12" aria-hidden="true" tabindex="-1"></a>null_rs <span class="sc">%&gt;%</span></span>
<span id="cb29-13"><a href="tutorial.html#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb29-14"><a href="tutorial.html#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 6</span></span>
<span id="cb29-15"><a href="tutorial.html#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="do">##   .metric  .estimator  mean     n std_err .config             </span></span>
<span id="cb29-16"><a href="tutorial.html#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb29-17"><a href="tutorial.html#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 accuracy binary     0.926     3 0.00258 Preprocessor1_Model1</span></span>
<span id="cb29-18"><a href="tutorial.html#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 roc_auc  binary     0.5       3 0       Preprocessor1_Model1</span></span>
<span id="cb29-19"><a href="tutorial.html#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="tutorial.html#cb29-20" aria-hidden="true" tabindex="-1"></a>null_rs <span class="sc">%&gt;%</span></span>
<span id="cb29-21"><a href="tutorial.html#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-22"><a href="tutorial.html#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb29-23"><a href="tutorial.html#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> outcome,.pred_1,<span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-24"><a href="tutorial.html#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb29-25"><a href="tutorial.html#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-26"><a href="tutorial.html#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb29-27"><a href="tutorial.html#cb29-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;ROC curve for NULL Model&quot;</span>,</span>
<span id="cb29-28"><a href="tutorial.html#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Each resample fold is shown in a different color&quot;</span></span>
<span id="cb29-29"><a href="tutorial.html#cb29-29" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/nullmodel-1.png" width="672" /></p>
</div>
</div>
<div id="evaluate-on-the-testing-set-optional" class="section level3 hasAnchor" number="2.3.6">
<h3><span class="header-section-number">2.3.6</span> Evaluate on the Testing Set (Optional)<a href="tutorial.html#evaluate-on-the-testing-set-optional" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose we are done, we want to fit this workflow on training data, and evaluate it on our testing data. We pass the <code>last_fit()</code> function two parameters: our finalized workflow and our data split.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="tutorial.html#cb30-1" aria-hidden="true" tabindex="-1"></a>final_wf <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(lasso_upsample_wf, tweet_df_split)</span>
<span id="cb30-2"><a href="tutorial.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(final_wf)</span>
<span id="cb30-3"><a href="tutorial.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 4</span></span>
<span id="cb30-4"><a href="tutorial.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   .metric  .estimator .estimate .config             </span></span>
<span id="cb30-5"><a href="tutorial.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb30-6"><a href="tutorial.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 accuracy binary         0.829 Preprocessor1_Model1</span></span>
<span id="cb30-7"><a href="tutorial.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 roc_auc  binary         0.818 Preprocessor1_Model1</span></span></code></pre></div>
<p>The confusion matrix on the testing data.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="tutorial.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the confusion matrix</span></span>
<span id="cb31-2"><a href="tutorial.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_predictions</span>(final_wf) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="tutorial.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> outcome, <span class="at">estimate =</span> .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="tutorial.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">&quot;heatmap&quot;</span>)</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/cmtest-1.png" width="672" /></p>
<p>ROC curve for the testing set.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="tutorial.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_predictions</span>(final_wf)  <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="tutorial.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> outcome, .pred_1, <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="tutorial.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb32-4"><a href="tutorial.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-5"><a href="tutorial.html#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb32-6"><a href="tutorial.html#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;ROC curve&quot;</span>,</span>
<span id="cb32-7"><a href="tutorial.html#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;With final tuned lasso regularized classifier on the test set&quot;</span></span>
<span id="cb32-8"><a href="tutorial.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="AI4PH2022_files/figure-html/roctest-1.png" width="672" /></p>
<p>Understand the most important variables in the predictions.</p>
<p>We can use the <code>vip</code> package to understand what the most important variables are in the predictions.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="tutorial.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb33-2"><a href="tutorial.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb33-3"><a href="tutorial.html#cb33-3" aria-hidden="true" tabindex="-1"></a>final_imp <span class="ot">&lt;-</span> <span class="fu">extract_fit_parsnip</span>(final_wf<span class="sc">$</span>.workflow[[<span class="dv">1</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="tutorial.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  vip<span class="sc">::</span><span class="fu">vi</span>()</span>
<span id="cb33-5"><a href="tutorial.html#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="tutorial.html#cb33-6" aria-hidden="true" tabindex="-1"></a>final_imp<span class="sc">%&gt;%</span><span class="fu">filter</span>(Sign <span class="sc">==</span> <span class="st">&quot;POS&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Importance)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb33-7"><a href="tutorial.html#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="tutorial.html#cb33-8" aria-hidden="true" tabindex="-1"></a>final_imp <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="tutorial.html#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-10"><a href="tutorial.html#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sign =</span> <span class="fu">case_when</span>(Sign <span class="sc">==</span> <span class="st">&quot;POS&quot;</span> <span class="sc">~</span> <span class="st">&quot;More about Plausible Covid-19 Cases&quot;</span>,</span>
<span id="cb33-11"><a href="tutorial.html#cb33-11" aria-hidden="true" tabindex="-1"></a>                     Sign <span class="sc">==</span> <span class="st">&quot;NEG&quot;</span> <span class="sc">~</span> <span class="st">&quot;Less about Plausible Covid-19 Cases&quot;</span>),</span>
<span id="cb33-12"><a href="tutorial.html#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Importance =</span> <span class="fu">abs</span>(Importance),</span>
<span id="cb33-13"><a href="tutorial.html#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> <span class="fu">str_remove_all</span>(Variable, <span class="st">&quot;tfidf_processed_tweet_&quot;</span>),</span>
<span id="cb33-14"><a href="tutorial.html#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> <span class="fu">str_remove_all</span>(Variable, <span class="st">&quot;textfeature_narrative_copy_&quot;</span>)</span>
<span id="cb33-15"><a href="tutorial.html#cb33-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb33-16"><a href="tutorial.html#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sign) <span class="sc">%&gt;%</span></span>
<span id="cb33-17"><a href="tutorial.html#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">20</span>, Importance) <span class="sc">%&gt;%</span></span>
<span id="cb33-18"><a href="tutorial.html#cb33-18" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span></span>
<span id="cb33-19"><a href="tutorial.html#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Importance,</span>
<span id="cb33-20"><a href="tutorial.html#cb33-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">fct_reorder</span>(Variable, Importance),</span>
<span id="cb33-21"><a href="tutorial.html#cb33-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> Sign)) <span class="sc">+</span></span>
<span id="cb33-22"><a href="tutorial.html#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb33-23"><a href="tutorial.html#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb33-24"><a href="tutorial.html#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Sign, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-25"><a href="tutorial.html#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-26"><a href="tutorial.html#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb33-27"><a href="tutorial.html#cb33-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Variable importance for predicting Plausible COVID-19 Cases&quot;</span>,</span>
<span id="cb33-28"><a href="tutorial.html#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;These features are the most important in predicting</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb33-29"><a href="tutorial.html#cb33-29" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;whether a tweet is about Plausible COVID-19 Cases or not&quot;</span>)</span>
<span id="cb33-30"><a href="tutorial.html#cb33-30" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Hvitfeldt2022-hm" class="csl-entry">
Hvitfeldt, Emil, and Julia Silge. 2022. <em>Supervised Machine Learning for Text Analysis in <span>R</span></em>. Chapman; Hall/CRC.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="prerequisite.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tutorial2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["AI4PH2022.pdf", "AI4PH2022.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
